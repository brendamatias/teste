<p-confirmDialog></p-confirmDialog>
<form [formGroup]="expense" (ngSubmit)="onSave()" novalidate>
  <div class="grid">
    <div class="col-12">
      <div class="card">
        <div class="grid">
          <div class="col-1"></div>
          <div class="col-4">
            <div class="flex flex-column gap-2">
              <label for="category">Categoria</label>
              <p-dropdown
                id="category"
                [options]="categories"
                optionLabel="name"
                optionValue="id"
                formControlName="category"
                [filter]="true"
                [filterFields]="utils.filterCategoriesFields"
                [showClear]="true"
                placeholder="Selecionar a categoria"
                class="drop-full w-full"
              >
                <ng-template let-c pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ c.name }} ({{ c.description }})</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </div>
          <div class="col-3">
            <div class="flex flex-column gap-2">
              <label for="amount">Valor da Despesa</label>
              <input
                pInputText
                id="amount"
                aria-describedby="amount-help"
                formControlName="amount"
              />
              <small
                class="p-error block"
                *ngIf="
                  expense.get('amount')?.invalid && expense.get('amount')?.dirty
                "
              >
                Obrigatório informar o valor da despesa</small
              >
            </div>
          </div>
          <div class="col-2">
            <div class="flex flex-column gap-2">
              <label for="paymentDate">Data de pagamento</label>
              <p-calendar
                id="paymentDate"
                aria-describedby="paymentDate-help"
                formControlName="paymentDate"
                [readonlyInput]="true"
                view="date"
                dateFormat="dd/mm/yy"
                class="max-w-full"
              />
              <small
                class="p-error block"
                *ngIf="
                  expense.get('paymentDate')?.invalid &&
                  expense.get('paymentDate')?.dirty
                "
              >
                Obrigatório informar a data de pagamento da despesa</small
              >
            </div>
          </div>
          <div class="col-2"></div>
          <div class="col-1">&nbsp;</div>
          <div class="col-9">
            <div class="flex flex-column gap-2">
              <label for="expenseName">Nome da Despesa</label>
              <input
                pInputText
                id="expenseName"
                aria-describedby="expenseName-help"
                formControlName="expenseName"
              />
              <small
                class="p-error block"
                *ngIf="
                  expense.get('expenseName')?.invalid &&
                  expense.get('expenseName')?.dirty
                "
              >
                Obrigatório informar a descrição da despesa</small
              >
            </div>
          </div>
          <div class="col-2"></div>
          <div class="col-1"></div>
          <div class="col-2">
            <div class="flex flex-column gap-2">
              <label for="competence">Competência</label>
              <p-calendar
                id="competence"
                aria-describedby="competence-help"
                formControlName="competence"
                [readonlyInput]="true"
                view="month"
                [maxDate]="maxDate"
                dateFormat="mm/yy"
                class="max-w-full"
              />
              <small
                class="p-error block"
                *ngIf="
                  expense.get('competence')?.invalid &&
                  expense.get('competence')?.dirty
                "
              >
                Obrigatório informar a competência da nota fiscal</small
              >
            </div>
          </div>
          <div class="col-2">
              <div class="flex flex-column gap-2">
                <label for="company">Empresa</label>
                <p-dropdown
                  id="company"
                  [options]="companies"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="company"
                  [filter]="true"
                  [filterFields]="utils.filterCompaniesFields"
                  [showClear]="true"
                  placeholder="Selecionar a empresa"
                  class="drop-full w-full"
                >
                  <ng-template let-c pTemplate="item">
                    <div class="flex align-items-center gap-2">
                      <div>{{ c.name }} ({{ utils.formatDocument(c.cnpj) }})</div>
                    </div>
                  </ng-template>
                </p-dropdown>
              </div>
            </div>
        </div>
        <div class="flex flex-row-reverse flex-wrap">
          <div class="col-2"></div>
          <button
            pButton
            pRipple
            [icon]="id ? 'pi pi-save' : 'pi pi-plus'"
            type="submit"
            [label]="id ? 'Salvar' : 'Incluir'"
            class="p-button-success m-2"
            [disabled]="expense.invalid"
          ></button>
        </div>
      </div>
    </div>
  </div>
</form>
